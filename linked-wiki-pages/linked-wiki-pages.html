<!--

Tried to read theme data from user to no awail:
Base on this stackoverflow:
https://stackoverflow.com/questions/61075867/azure-devops-extension-user-theme-and-fluentui-components

//https://dev.azure.com/{org}/_apis/Settings/Entries/me/WebPlatform

VSS.require(["TFS/WorkItemTracking/Services","VSS/Settings/Services"], function (_WorkItemServices,_SettingsServices) {

// Get the WorkItemFormService.  This service allows you to get/set fields/links on the 'active' work item (the work item
// that currently is displayed in the UI).
function getWorkItemFormService()
{
    return _WorkItemServices.WorkItemFormService.getService();
}

var entries = service.getEntriesAsync("WebPlatform", _SettingsServices.SettingsUserScope.Me);

-->

<!DOCTYPE html>
<html>
<head>
    <title>Link Work to Wiki</title>
</head>
<body style="background-color:rgb(32,31,30); overflow-y: scroll !important;width:100%;height:100%">

    <script src="vsts/VSS.SDK.min.js"></script>

    <script src="knockout/knockout-latest.js"></script>

    <script src="js/model.js"></script>
    <script src="js/viewModel.js"></script>

    <script>
        VSS.init({
            explicitNotifyLoaded: true,
            usePlatformScripts: true,
            usePlatformStyles: true
        });

        var module = function(workItemsTrackingServices, artifactsServices, artifactsConstants, servicesSettings) {
            var model = getModel(workItemsTrackingServices);
            var viewModel = getViewModel(model, artifactsServices, artifactsConstants);

            ko.applyBindings(viewModel, document.getElementById("container"));


            var listener = function () {
                return {
                    // called when a new work item is being loaded in the UI
                    onLoaded: function (args) {
                        viewModel.reload();
                    },

                    // called when the active work item is modified
                    onFieldChanged: function(args) {
                        viewModel.reload();
                    },

                    // called after the work item has been saved
                    onSaved: function (args) {
                        viewModel.reload();
                    },

                    // called when the work item is reset to its unmodified state (undo)
                    onReset: function (args) {
                        viewModel.reload();
                    },

                    // called when the work item has been refreshed from the server
                    onRefreshed: function (args) {
                        viewModel.reload();
                    }
                };
            };

            // register a listener for the work item page contribution
            VSS.register(VSS.getContribution().id, listener);

            VSS.notifyLoadSucceeded();
        };

        VSS.require([
            "TFS/WorkItemTracking/Services",
            "VSS/Artifacts/Services",
            "VSS/Artifacts/Constants",
            "VSS/Settings/Services"
        ], module);
    </script>
    

        <div id="container" >
            <div data-bind="visible: isWaitVisible" style="color:white">
                Please wait for links to be loaded...
            </div>
            
            <div data-bind="visible: isLinksVisible">
                <div data-bind="foreach: links">
                    <p>
                        <a data-bind="attr: { href: url }" target="_blank" style="color:#7FFFD4">
                            <span data-bind="text: text">
                            </span>
                        </a>
                    </p>
                </div>
            </div>
            
            <div data-bind="visible: isEmptyVisible" style="color:white">
                There are no wiki pages linked to current work item
            </div>
            
            <div data-bind="visible: isErrorVisible">
                <span class="validation-error">
                    <span class="icon-error-exclamation"></span>
                    <span data-bind="text: error" class="validation-error-text"></span>
                </span>
            </div>
            
        </div>

</body>
</html>